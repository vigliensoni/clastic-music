---
layout: post
current: post
cover:  assets/images/tb303-inv.jpg
navigation: True
title: TB303 modeling
date: 2021-02-01 5:34:00
tags: [DDSP, TB303]
class: post-template
subclass: 'post'
author: gabriel
---

## The Roland TB-303

The Roland TB-303 synthesizer was released in 1982 as a device meant to mimic bass sounds and sequences. Upon release it was a failure, not many units were sold, and its price went down. A few years later, the 303 started to be used also as a bass sequencer/synthesizer but it the context of a musical genre that it wasn't designed for: Acid House. After a number of years and many releases, it provides the musical genre of its unique timbral signature, original Roland units are now sold at thousands of dollars, and many hardware and software emulators have been released.

## Diferentiable Digital Signal Processing

Google Magenta's DDSP library was released in 2019. It uses neural networks to learn the parameters of a digital signal processing pipeline based on user input (including the audio itself) to (re)create audio signals. Examples of models trained using DDSP are common, classical instruments such as violin, trumpet, etc.

## D-303

I want to learn a DDSP model of the TB303. For this, I created 30 minutes of patterns using the ABL3 TB303 emulator. 

I set up DDSP on a computer cluster, and left training the model for 400K steps until achieving an average loss of 4.94 in the last 1K steps.

When using a voice to do timbre transfer, the model is able to follow the voice pitches while retaining some characteristics of the 303.

The following are the basic features to tweak when _conditioning_ the generation of audio:

- NDT: Note detection
- AQP: Adjustment for quiet parts
- ATT: Force pitch to nearest note/Autotune 
- MPS: Manual Pitch Shift
- LDS: Loudness Shift

I will use them in the form (NDT, AQP, ATT, MPS, LDS)

Audio generation results with a few different settings.

Human voice as target

- Original voice

<iframe src="https://archive.org/embed/ddsp-timbre-transfer-01/audio-in.wav#" width="500" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>

- [01-tb-303-01](https://archive.org/download/ddsp-timbre-transfer-01/01-tb-303-00.wav) (1, 30, 0.5, 0, 0) all default values

<iframe src="https://archive.org/embed/ddsp-timbre-transfer-01/01-tb-303-00.wav#" width="500" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>


It seems the pitch is somehow grabbed in the upper octave, and is pretty jumpy.

- 01-tb-303-01 (1, 30, 0.5, -1, 0)

<iframe src="https://archive.org/embed/ddsp-timbre-transfer-01/01-tb-303-01.wav#" width="500" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>

Now the octave seems correct (at least for the 303 bassline). The pitch is still jumpy.

## Bass sounds

- Pulsing:
<iframe src="https://archive.org/embed/ddsp-timbre-transfer-01/synth-bass.wav#" width="500" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>

- Transfer:
<iframe src="https://archive.org/embed/ddsp-timbre-transfer-01/01-tb-303-02.wav#" width="500" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>

- Square bass different notes
<iframe src="https://archive.org/embed/ddsp-timbre-transfer-01/synth-bass-2.wav#" width="500" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>

- Transfer
<iframe src="https://archive.org/embed/ddsp-timbre-transfer-01/01-tb-303-03.wav#" width="500" height="30" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>


All files together

<iframe src="https://archive.org/details/ddsp-timbre-transfer-01/" width="500" height="300" frameborder="0" webkitallowfullscreen="true" mozallowfullscreen="true" allowfullscreen></iframe>